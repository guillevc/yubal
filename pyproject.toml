[project]
name = "yubal"
version = "0.1.2"
description = "YouTube Album Downloader with auto-tagging via beets"
requires-python = ">=3.12"
dependencies = [
  "beets[lastgenre]>=2.5.1",
  "fastapi>=0.127.1",
  "loguru>=0.7.3",
  "mutagen>=1.47.0",            # Audio metadata (also via beets)
  "numpy<2.0",                  # Pin to 1.x for older CPU compatibility (X86_V2 requirement in 2.x)
  "pydantic-settings>=2.12.0",
  "uvicorn[standard]>=0.40.0",
  "yt-dlp[default]>=2025.12.8",
]

[dependency-groups]
dev = [
  "dead>=2.1.0",
  "pytest>=9.0.2",
  "pytest-asyncio>=1.3.0",
  "pytest-cov>=7.0.0",
  "ruff>=0.14.10",
  "ty>=0.0.7",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["yubal"]

[tool.ruff]
target-version = "py312"
line-length = 88
exclude = [".venv", "__pycache__", ".git", "build", "dist", "web"]

[tool.ruff.lint]
select = [
  "E",   # pycodestyle errors
  "F",   # pyflakes
  "I",   # isort
  "B",   # bugbear
  "UP",  # pyupgrade
  "S",   # bandit security
  "RUF", # ruff-specific
]
ignore = [
  "S603", # subprocess calls are internal tools, not untrusted
  "S607", # partial paths are fine for ffprobe/beets
]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = [
  "S101", # assert is expected in tests
  "S108", # /tmp paths in tests are fixtures, not real usage
]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.ruff.lint.isort]
force-single-line = false
known-first-party = ["yubal"]

[tool.coverage.run]
source = ["yubal"]

[tool.coverage.report]
omit = ["tests/*"]
